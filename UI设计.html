<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>UIè®¾è®¡</title>
</head>
<style>
	html{
		margin: 0;
		padding: 0;
		width: 100%;
		height: 100%;
	}
	body{
		margin: 0;
		padding: 0;
		width: 100%;
		height: 100%;
		background-color: #333;
		transition: transform 1s ease;
	}
	span{
		-moz-user-select: none; /*ç«ç‹*/
		-webkit-user-select: none; /*webkitæµè§ˆå™¨*/
		-ms-user-select: none; /*IE10*/
		user-select: none;
	}
	input::-webkit-input-placeholder{
        color:white;
    }
    input::-moz-placeholder{   /* Mozilla Firefox 19+ */
        color:white;
    }
    input:-moz-placeholder{    /* Mozilla Firefox 4 to 18 */
        color:white;
    }
    input:-ms-input-placeholder{  /* Internet Explorer 10-11 */
        color:white;
    }
	.main-box{
		position: relative;
		height: 100%;
		width: 100%;
		overflow: hidden;
		/*box-shadow: 2px 2px px 0 rgb(0,0,0);*/
	}
	.danmu-box{
		position: absolute;
		top: 0;
		height: 100%;
		width: 100%;
		background-color: transparent;
	}
	.danmu{
		position: absolute;
		left: 0;
		width: 20px;
		color: #fff;
		font-size: 22px;
		/*background-color: orange;*/
		transform: translateY(-100%);
		transition: all 5s linear;
	}
	.danmu span{
		word-break:break-all;
	}
	.danmu-insert-box{
		position: absolute;
		bottom: 0;
		width: 100%;
		height: 120px;
		background-color: #fff;
		display: flex;
	}
	.danmu-insert{
		height: 40px;
		width: 150px;
		border-radius: 20px;
		margin: 40px 0 10px 60px;
		background-color: #d2ebff;
		overflow: hidden;
		padding-left: 10px;
		transition: all 0.3s ease;
		color: #fff;
	}
	.danmu-insert:hover{
		background-color: #89cbff !important;
		border-radius: 3px !important;
	}
	.danmu-insert input{
		border: 0;
		outline: none;
		display: block;
		width: 100%;
		height: 100%;
		background-color: transparent;
		font-size: 18px;
		color: #fff;
	}
	.send-button{
		height: 40px;
		width: 80px;
		margin: 40px 10px 0 10px;
		border-radius: 20px;
		background-color: #e4fbfc;
		text-align: center;
		line-height: 40px;
		letter-spacing: 2px;
		cursor: pointer;
		transition: all 0.3s ease;
		overflow: hidden;
	}
	.send-button:hover{
		background-color: #79f0ff !important;
		border-radius: 3px !important;
	}



	.header {
		height: 100%;
	    position: relative;
	    text-align: center;
	    background: linear-gradient(60deg, rgba(84,58,183,1) 0%, rgba(0,172,193,1) 100%);
	    color: white;
	}
	.waves {
	    position: absolute;
	    bottom: 120px;
	    left: 0;
	    width: 100%;
	    height: 15vh;
	    margin-bottom: -7px;
	    /*Fix for safari gap*/
	    min-height: 100px;
	    max-height: 150px;
	}
	.content {
	    position: relative;
	    height: 20vh;
	    text-align: center;
	    background-color: white;
	}
	.parallax >use {
	    animation: move-forever 25s cubic-bezier(.55,.5,.45,.5) infinite;
	}
	.parallax >use:nth-child(1) {
	    animation-delay: -2s;
	    animation-duration: 7s;
	}
	.parallax >use:nth-child(2) {
	    animation-delay: -3s;
	    animation-duration: 10s;
	}
	.parallax >use:nth-child(3) {
	    animation-delay: -4s;
	    animation-duration: 13s;
	}
	.parallax >use:nth-child(4) {
	    animation-delay: -5s;
	    animation-duration: 20s;
	}
	@keyframes move-forever {
	    0% {
	        transform: translate3d(-90px,0,0);
	    }

	    100% {
	        transform: translate3d(85px,0,0);
	    }
	}
	@media (max-width: 768px) {
	    .waves {
	        height:40px;
	        min-height: 40px;
	    }

	    .content {
	        height: 30vh;
	    }

	    h1 {
	        font-size: 24px;
	    }
	}

</style>
<body id="body" onmouseup="mouseUp()">
	<div class="main-box">
		<div class="header">
			<svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
				<defs>
					<path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
				</defs>
				<g class="parallax">
					<use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7"></use>
					<use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)"></use>
					<use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)"></use>
					<use xlink:href="#gentle-wave" x="48" y="7" fill="#fff"></use>
				</g>
			</svg>
		</div>
		<div class="danmu-box" id="danmuBox">

		</div>
		<div class="danmu-insert-box">
			<div class="danmu-insert" id="danmuText" onmousedown="mouseDown()" onmouseup="mouseUp()">
				<input type="text" id="input" placeholder="æ¥ç•…å¿«åœ°èŠå¤©å§">
			</div>
			<div  id="sendBtn" class="send-button" onmouseup="getDanmu()">
				<span>å‘é€</span>
			</div>
		</div>
	</div>
<script type="text/javascript">
	// window.onload = function (){
	// 	initWebSocket()
	//
	// 	//WebSocketæ–¹æ³•
	// 	//è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•
	// 	websocket.onerror = function(){
	// 		console.log('è¿æ¥é”™è¯¯');
	// 	};
	// 	//è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•
	// 	websocket.onopen = function(event){
	// 		console.log("è¿æ¥æˆåŠŸ",event);
	// 	}
	// 	//æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•
	// 	websocket.onmessage = function(event){
	// 		console.log(event.data);
	// 		// sendDanmu('')
	// 	}
	// 	//è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•
	// 	websocket.onclose = function() {
	// 		console.log("å…³é—­è¿æ¥");
	// 	}
	// }

	//è·å–è£…å¼¹å¹•çš„ç›’å­ç”¨äºå‘é‡Œé¢æ·»åŠ å¼¹å¹•
	let danmuBox = document.getElementById('danmuBox')
	//è·å–è¾“å…¥æ¡†ï¼Œç”¨äºæ‹¿åˆ°è¾“å…¥çš„ä¿¡æ¯
	let input = document.getElementById("input")
	//è·å–æ•´ä¸ªé¡µé¢ç”¨äºç¿»è½¬
	let body = document.getElementById("body")
	//è¾“å…¥æ¡†ç›’å­ç”¨äºæ§åˆ¶è¾“å…¥æ¡†çš„å¤§å°
	let inputBox = document.getElementById("danmuText")
	//å‘é€æŒ‰é’®
	let sendBtn = document.getElementById("sendBtn")
	//ç”¨æ¥é˜²æ­¢åœ¨è¾“å…¥æ¡†ä¸­æŒ‰ä¸‹é¼ æ ‡ï¼Œåœ¨å…¶ä»–åœ°æ–¹æ¾å¼€é¼ æ ‡ä¸è°ƒç”¨å‡½æ•°çš„å˜é‡
	let isMosueDown = false
	let isFocus = false
	// let websocket = null
	// //åˆå§‹åŒ–websocket
	// function initWebSocket(){
	// 	let id = get_uuid()
	// 	if('WebSocket' in window){
	// 		websocket = new WebSocket("ws://39.107.101.13:8086/ws/" + id)
	// 	} else {
	// 		alert('æµè§ˆå™¨ä¸æ”¯æŒé€šä¿¡')
	// 	}
	// }
	//
	// //ç»™æ¯ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ªéšæœºä¸é‡å¤id
	// function get_uuid(){
	// 	let s = [];
	// 	let hexDigits = "0123456789abcdef";
	// 	for (let i = 0; i < 36; i++) {
	// 		s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
	// 	}
	// 	s[14] = "4";
	// 	s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
	// 	s[8] = s[13] = s[18] = s[23] = "-";
	//
	// 	let uuid = s.join("");
	// 	return uuid;
	// }
	//
	// //ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œé˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚
	// window.onbeforeunload = function(){
	// 	websocket.close();
	// }


	//å›è½¦é”®è‡ªåŠ¨å‘é€
	document.onkeydown = function(e){
		if(e.keyCode === 13){//å¦‚æœæŒ‰å›è½¦é”®è°ƒç”¨è·å–å†…å®¹çš„å‡½æ•°
			if(isFocus){

			} else {
				mouseDown()
			}
		}
	}
	document.onkeyup = function(e){
		if(e.keyCode === 13){
			if(isFocus){
				getDanmu()
				// input.blur()
			} else {
				mouseUp()
				input.focus()
			}
		}
	}
	//è¾“å…¥æ¡†èšç„¦å’Œå¤±ç„¦çš„æ ·å¼æ”¹å˜
	input.onfocus = function(){
		isFocus = true
	}
	input.onblur = function(){
		if(input.value === ""){
			inputBox.style.width = "150px"
			inputBox.style.borderRadius = "20px"
			inputBox.style.backgroundColor = "#d2ebff"
		}
		isFocus = false
	}

	//è¾“å…¥æ¡†å¾®åŠ¨ç”»
	function mouseDown(){
		if(!isFocus && input.value === ""){
			inputBox.style.width = "130px"
			isMosueDown = true
		}
	}
	function mouseUp(){
		if(isMosueDown){
			inputBox.style.width = "600px"
			inputBox.style.borderRadius = "3px"
			inputBox.style.backgroundColor = "#89cbff"

			isMosueDown = false
		}
	}
	//è·å–å¼¹å¹•
	function getDanmu(){

		let text = input.value	//ä»è¾“å…¥æ¡†ä¸­è·å–è¾“å…¥çš„å†…å®¹
		if(text === ''){	//å¦‚æœæ²¡æœ‰è¾“å…¥(ä¸ºç©ºå­—ç¬¦)
			sendBtn.style.backgroundColor = "#ec7a61"
			sendBtn.style.width = "160px"
			sendBtn.innerText = "ä½ è¯´ä½ ğŸå‘¢"
			setTimeout(()=>{
				sendBtn.style.width = "80px"
				sendBtn.style.backgroundColor = "#bfe9eb"
				sendBtn.innerText = "å‘é€"
			},1000)
		} else if(text === '666'){
			body.style.transform = "rotateZ(180deg)"
			sendDanmu(text)
			input.value = ''
		} else {
			sendDanmu(text)	//è°ƒç”¨å‘é€å¼¹å¹•å‡½æ•°
			input.value = ''//å°†è¾“å…¥æ¡†æ¸…ç©ºï¼Œä»¥ä¾¿ä¸‹æ¬¡å‘é€

			/** ç‚¹å‡»æ—¶æ— æ³•ä¸»åŠ¨è§¦å‘bluräº‹ä»¶*/
			input.blur() //ä¸»åŠ¨å¤±å»ç„¦ç‚¹ï¼Œæ¢å¤çŸ­çŸ©å½¢çŠ¶æ€

			sendBtn.style.backgroundColor = "#76fea6"
			sendBtn.style.width = "160px"
			sendBtn.innerText = "è¯´çš„è¿˜çœŸä¸é”™"
			setTimeout(()=>{
				sendBtn.style.width = "80px"
				sendBtn.style.backgroundColor = "#bfe9eb"
				sendBtn.innerText = "å‘é€"
			},1000)
		}
	}
	//å‘é€å¼¹å¹•
	function sendDanmu(text){

		let i = Math.floor(Math.random()*parseInt(document.body.clientWidth/20))//ç”¨æ¥æ§åˆ¶å¼¹å¹•ä½ç½®çš„éšæœºå‡½æ•°
		let danmu = document.createElement('div')//åˆ›å»ºä¸€ä¸ªå¼¹å¹•å…ƒç´ 
		danmu.setAttribute("class","danmu")//è®¾ç½®å…ƒç´ çš„æ ·å¼
		danmu.style.top = '0px'//å…ƒç´ ä»é¡¶éƒ¨ç”Ÿæˆ
		danmu.style.left =  i*20 +'px'//å…ƒç´ è·ç¦»å·¦è¾¹çš„è·ç¦»(æ ¹æ®éšæœºæ•°è°ƒæ•´)
		danmu.innerHTML = "<span>" + text + "</span>"//å°†è¾“å…¥çš„ä¿¡æ¯æ·»åŠ åˆ°å…ƒç´ ä¸­å»
		danmuBox.appendChild(danmu)//å°†å…ƒç´ æ”¾åˆ°é¡µé¢ä¸Š

		moveDanmu(danmu)//è®©å…ƒç´ å¼€å§‹ä¸‹è½

		removeDanmu()//åˆ é™¤å…ƒç´ 
	}
	//è®©å¼¹å¹•ç§»åŠ¨
	function moveDanmu(el){
		setTimeout(()=>{
			el.style.top = "740px"
			el.style.transform = "translateY(100%)"
		},0)
	}
	//å¼¹å¹•åˆ°åº•åç§»é™¤å¼¹å¹•
	function removeDanmu(){
		setTimeout(()=>{
			danmuBox.removeChild(danmuBox.childNodes[1])
		},5000)
	}
</script>
</body>
</html>
